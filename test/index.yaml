desc: シナリオテスト
vars:
  admin_email: "test01@example.com"
  admin_name: "Test Admin"
  admin_password: "password01"
  update_email: "test02@example.com"
  update_name: "Test Update"
  update_password: "password02"
  normal_email: "test03@example.com"
  normal_name: "Test Normal"
  normal_password: "password03"
steps:
  truncate_db:
    include:
      path: truncate.yaml
  create_admin_user:
    include:
      path: createUser.yaml
      vars:
        email: "{{ vars.admin_email }}"
        name: "{{ vars.admin_name }}"
        password: "{{ vars.admin_password }}"
  bind_admin_user:
    bind:
      admin_identifier: steps.create_admin_user.identifier
      admin_access_token: steps.create_admin_user.access_token
      admin_refresh_token: steps.create_admin_user.refresh_token
  wait_first:
    exec:
      command: "sleep 2"
      shell: bash
  update_admin_user:
    include:
      path: updateUser.yaml
      vars:
        identifier: "{{ admin_identifier }}"
        password: "{{ vars.admin_password }}"
        email: "{{ vars.admin_email }}"
        new_email: "{{ vars.update_email }}"
        new_name: "{{ vars.update_name }}"
        new_password: "{{ vars.update_password }}"
  bind_update_user:
    bind:
      update_access_token: steps.update_admin_user.refresh_access_token
      update_refresh_token: steps.update_admin_user.login_refresh_token
  get_role:
    include:
      path: getRole.yaml
      vars:
        access_token: "{{ update_access_token }}"
  wait_second:
    exec:
      command: "sleep 2"
      shell: bash
  create_company:
    include:
      path: createCompany.yaml
      vars:
        access_token: "{{ update_access_token }}"
        name: "Test Company"
        user_identifier: "{{ admin_identifier }}"
  bind_company:
    bind:
      company_identifier: steps.create_company.identifier
      company_access_token: steps.create_company.access_token
  create_normal_user:
    include:
      path: createUser.yaml
      vars:
        email: "{{ vars.normal_email }}"
        name: "{{ vars.normal_name }}"
        password: "{{ vars.normal_password }}"
  bind_normal_user:
    bind:
      normal_identifier: steps.create_normal_user.identifier
      normal_access_token: steps.create_normal_user.access_token
      normal_refresh_token: steps.create_normal_user.refresh_token
  assign_company:
    include:
      path: companyUser.yaml
      vars:
        company_identifier: "{{ company_identifier }}"
        admin_access_token: "{{ company_access_token }}"
        user_identifier: "{{ normal_identifier }}"
        normal_access_token: "{{ normal_access_token }}"
