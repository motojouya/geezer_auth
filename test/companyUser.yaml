desc: 企業へのユーザ登録
runners:
  req: http://localhost:${PORT}
vars:
  company_identifier: "dummy"
  admin_access_token: "dummy"
  user_identifier: "dummy"
  normal_access_token: "dummy"
  role_employee: "EMPLOYEE"
  role_manager: "MANAGER"
steps:
  invite_company:
    desc: invite token発行
    req:
      /company/{{ vars.company_identifier }}/invite:
        post:
          headers:
            Authorization: "Bearer {{ vars.admin_access_token }}"
          body:
            application/json:
              role_label: "{{ vars.role_employee }}"
    test: steps.invite_company.res.status == 200
  accept_company:
    desc: invite accept
    req:
      /company/{{ vars.company_identifier }}/accept:
        post:
          headers:
            Authorization: "Bearer {{ vars.normal_access_token }}"
          body:
            application/json:
              token: "{{ steps.invite_company.res.body.token }}"
    test: steps.accept_company.res.status == 200
  assign_user:
    desc: 指定してアサイン
    req:
      /company/{{ vars.company_identifier }}/assign:
        post:
          headers:
            Authorization: "Bearer {{ vars.admin_access_token }}"
          body:
            application/json:
              role_label: "{{ vars.role_manager }}"
              user_identifier: "{{ vars.user_identifier }}"
    test: steps.assign_user.res.status == 200
  get_user:
    desc: 企業情報の取得
    req:
      /company/{{ vars.company_identifier }}/user:
        get:
          headers:
            Authorization: "Bearer {{ vars.admin_access_token }}"
    test: |
      steps.get_user.res.status == 200
      && len(steps.get_user.res.body.users) == 2
      && steps.get_user.res.body.users[1].identifier == vars.user_identifier
      && steps.get_user.res.body.users[1].company_role.company.identifier == vars.company_identifier
      && steps.get_user.res.body.users[1].company_role.roles[0].label == vars.role_employee
      && steps.get_user.res.body.users[1].company_role.roles[1].label == vars.role_manager
